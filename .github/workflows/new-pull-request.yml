name: new-pull-request

on:
  release:
    types:
      - published

jobs:
  build:

    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v1
    - name: Git config
      run: |
        git config --local user.email "oinume@gmail.com"
        git config --local user.name "actions"
    - name: Create local changes
      run: |
        echo $GITHUB_REF | sed 's/refs\/tags\///' > VERSION.txt
        cat VERSION.txt
        NEXT_VERSION=$(cat VERSION.txt | perl -ne 'if ($_ =~ /(.+)\.(.+)\.(.+)/) { $v = $3; $v++; print "$1.$2.$v\n" }')
        echo "::set-env name=NEXT_VERSION::$(echo $NEXT_VERSION)"
    - name: Commit files
      run: |
        git commit -m "Update VERSION" -a
    - name: Create a release branch
      run: |
        echo "Next version is $NEXT_VERSION"
    - uses: ad-m/github-push-action@master
      with:
        github_token: ${{ secrets.GITHUB_TOKEN }}
        branch: ${{ join('release/', env.NEXT_VERSION) }}
